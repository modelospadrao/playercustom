<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compara√ß√£o de V√≠deos ‚Äì Time‚ÄëLapse e Controles Avan√ßados</title>
  <style>
    /* Vari√°veis para ajuste manual */
    :root {
      --btn-gap: 10px;             /* Espa√ßamento entre os bot√µes */
      --btn-padding: 10px;         /* Padding interno dos bot√µes */
      --btn-margin: 5px;           /* Margem externa dos bot√µes */
      --container-padding: 10px;   /* Padding do cont√™iner dos bot√µes */
      --container-border: 1px solid #333; /* Borda do cont√™iner */
    }
    
    /* Evita rolagem horizontal e define margens gerais */
    html, body {
      overflow-x: hidden;
      margin: 3px 0px 15px 0px;
      padding: 0;
    }
    /* ESTILOS GERAIS */
    body {
      font-family: Cambria, Cochin, Georgia, Times, sans-serif;
      background-color: #f0f0f0;
    }
    h2 {
      text-align: center;
      margin: 2px 0;
      font-weight: bold;
    }
    h3 {
      text-align: center;
      margin: -15px 0;
      padding: 25px;
      font-family: "roboto";
      font-weight: bold;
    }
    .header-container {
      position: relative;
    }
    /* Popup esquerdo ‚Äì mensagem fixa "Grava√ß√£o iniciada" */
    #popupLeft {
      display: none;
      position: fixed;
      top: 15px;
      left: 10px;
      padding: 25px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 20px;
      font-family: "Courier New", Courier, monospace;
      font-style: italic;
      border-radius: 32px;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      text-align: center;
    }
    /* Popup direito ‚Äì temporizador digital */
    #popupRight {
      display: none;
      position: fixed;
      top: 15px;
      right: 10px;
      padding: 25px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 20px;
      font-family: "Courier New", Courier, monospace;
      font-style: italic;
      border-radius: 32px;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      text-align: center;
    }
    /* Popup de confirma√ß√£o para salvar a grava√ß√£o */
    #popupSave {
      display: none;
      position: fixed;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      font-size: 20px;
      font-family: "Courier New", Courier, monospace;
      border-radius: 32px;
      z-index: 1000;
      text-align: center;
    }
    /* Bot√µes de confirma√ß√£o */
    .btn-green {
      background-color: green;
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      font-size: 18px;
    }
    .btn-red {
      background-color: red;
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      font-size: 18px;
    }
    /* CONTAINER DOS V√çDEOS */
    .video-container {
      display: flex;
      flex-wrap: nowrap;
      justify-content: center;
      gap: 5px;
      margin: 2px 0;
      width: 97%;
      margin-left: auto;
      margin-right: auto;
    }
    .video-wrapper {
      flex: 1 1 0;
      max-width: calc((95% - -76px) / 3);
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 15px;
    }
    .volume-slider {
      width: 92%;
      margin-bottom: 12px;
    }
    .video-box {
      width: 98%;
      height: 100%;
      aspect-ratio: 16 / 9;
      padding: 5px;
      box-sizing: border-box;
      border: 2px dashed rgba(0, 0, 0, 0.5);
      background-color: #fff;
      box-shadow: 0 0 6px 2px #333;
      overflow: hidden;
      position: relative;
      margin: 0 auto;
    }
    .video-box video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center; /* Garante que o v√≠deo fique centralizado, se houver barras */
    }
    .progress-container {
      width: 80%;
      margin: 5px auto 0;
    }
    .progress-slider {
      width: 100%;
    }
    .time-display {
      text-align: center;
      font-size: 37px;
      font-family: "monospace";
      margin-top: -3px;
      margin-bottom: -2px;
    }
    .file-info {
      border: 0px solid #888;
      background-color: #eee;
      padding: 0px;
      margin-top: -5px;
      margin-bottom: 5px;
      width: 95%;
      text-align: left;
      font-size: 14px;
      margin-left: auto;
      margin-right: auto;
    }
    .file-info input {
      width: 93%;
      padding: 3px;
      margin-top: 0px;
    }
    .file-info button {
      margin-top: 3px;
      padding: 4px 8px;
      font-size: 12px;
    }
    /* CONTROLES INDIVIDUAIS ‚Äì cada bloco fica logo abaixo do v√≠deo */
    .video-controls {
      width: 95%;
      max-width: 640px;
      padding: 4px;
      border: 1px solid #333;
      border-radius: 8px;
      background-color: #fff;
      margin-top: 5px;
      text-align: center;
    }
    .controls-container.single-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--btn-gap);
      padding: var(--container-padding);
    }
    .controls-container.single-row button {
      margin: var(--btn-margin);
      padding: var(--btn-padding);
    }
    button {
      font-size: 20px;
      background-color: #444;
      color: #fff;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      box-shadow: 0 10px 0 rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    }
    button:active {
      transform: scale(0.98);
    }
    /* CONTROLES GERAIS ‚Äì para todos os v√≠deos, alinhados em duas linhas */
    .section {
      text-align: center;
      border: 3px solid #333;
      border-radius: 45px;
      padding: 13px;
      width: 90%;
      margin: 10px auto;
      background-color: #fff;
      overflow: hidden;
    }
    .general-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: var(--btn-gap);
      padding: var(--container-padding);
      border: var(--container-border);
      border-radius: 31px;
      border-color: #ffffff;
    }
    .general-controls button {
      flex: 1 1 150px;
      margin: var(--btn-margin);
      padding: var(--btn-padding);
    }
    /* Canvas usado para compor os v√≠deos ‚Äì oculto */
    #recordCanvas {
      display: none;
    }
    /* Estilo para a dica (tooltip) */
    .tooltip {
      position: absolute;
      background-color: black;
      color: white;
      border: 1px solid black;
      padding: 5px;
      font-size: 16px;
      border-radius: 5px;
      white-space: nowrap;
      z-index: 999;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <!-- Popups para grava√ß√£o -->
  <div id="popupLeft"></div>
  <div id="popupRight"></div>
  <!-- Popup de confirma√ß√£o para salvar a grava√ß√£o -->
  <div id="popupSave"></div>
  
  <!-- CABE√áALHO -->
  <div class="header-container">
    <h2 style="color:#e63946;">MODELO COMPARA√á√ÉO DE VIDEOMONITORAMENTOS</h2>
    <h2 style="font-size:21px; font-weight:bold; color:#000;">(Vers√£o 1.0)</h2>
  </div>
  
  <!-- CONTAINER DOS V√çDEOS -->
  <div class="video-container">
    <!-- V√≠deo 1 -->
    <div class="video-wrapper">
      <input type="range" class="volume-slider" id="volume1" min="0" max="1" step="0.01" value="1">
      <div class="video-box" id="box1" ondrop="drop(event)" ondragover="allowDrop(event)">
        <video id="video1"></video>
      </div>
      <div class="progress-container">
        <input type="range" class="progress-slider" id="progress1" min="0" max="100" step="0.1" value="0">
        <div class="time-display" id="timeDisplay1">00:00 / 00:00</div>
      </div>
      <div class="file-info" id="info1">
        <p>Arquivo: Nenhum</p>
        <p>Tamanho: 0</p>
        <input type="text" id="rename1" placeholder="Renomear arquivo">
      </div>
      <div class="video-controls">
        <h3>V√≠deo 1</h3>
        <div class="controls-container single-row">
          <button onclick="playVideo(1)" data-tooltip="Reproduzir v√≠deo 1">‚ñ∂Ô∏è</button>
          <button onclick="pauseVideo(1)" data-tooltip="Pausar v√≠deo 1">‚è∏Ô∏è</button>
          <button onclick="stopVideo(1)" data-tooltip="Parar v√≠deo 1">‚¨ú</button>
          <button onclick="rewind(1)" data-tooltip="Recuar v√≠deo 1">‚è™</button>
          <button onclick="normalizeVideo(1)" data-tooltip="Normalizar velocidade de v√≠deo 1">üîÑ</button>
          <button id="muteButton1" onclick="toggleMuteVideo(1)" data-tooltip="Alternar mudo para v√≠deo 1">üîä</button>
          <button onclick="fastForward(1)" data-tooltip="Avan√ßar v√≠deo 1">‚è©</button>
          <button onclick="slowMotion(1)" data-tooltip="C√¢mera lenta para v√≠deo 1">‚è±Ô∏è</button>
          <button onclick="toggleFullScreen(1)" data-tooltip="Tela cheia para v√≠deo 1">üñ•Ô∏è Tela Cheia</button>
          <button onclick="removeVideo(1)" data-tooltip="Remover v√≠deo 1">‚úñÔ∏è Remover V√≠deo</button>
        </div>
      </div>
    </div>
    
    <!-- V√≠deo 2 -->
    <div class="video-wrapper">
      <input type="range" class="volume-slider" id="volume2" min="0" max="1" step="0.01" value="1">
      <div class="video-box" id="box2" ondrop="drop(event)" ondragover="allowDrop(event)">
        <video id="video2"></video>
      </div>
      <div class="progress-container">
        <input type="range" class="progress-slider" id="progress2" min="0" max="100" step="0.1" value="0">
        <div class="time-display" id="timeDisplay2">00:00 / 00:00</div>
      </div>
      <div class="file-info" id="info2">
        <p>Arquivo: Nenhum</p>
        <p>Tamanho: 0</p>
        <input type="text" id="rename2" placeholder="Renomear arquivo">
      </div>
      <div class="video-controls">
        <h3>V√≠deo 2</h3>
        <div class="controls-container single-row">
          <button onclick="playVideo(2)" data-tooltip="Reproduzir v√≠deo 2">‚ñ∂Ô∏è</button>
          <button onclick="pauseVideo(2)" data-tooltip="Pausar v√≠deo 2">‚è∏Ô∏è</button>
          <button onclick="stopVideo(2)" data-tooltip="Parar v√≠deo 2">‚¨ú</button>
          <button onclick="rewind(2)" data-tooltip="Recuar v√≠deo 2">‚è™</button>
          <button onclick="normalizeVideo(2)" data-tooltip="Normalizar velocidade de v√≠deo 2">üîÑ</button>
          <button id="muteButton2" onclick="toggleMuteVideo(2)" data-tooltip="Alternar mudo para v√≠deo 2">üîä</button>
          <button onclick="fastForward(2)" data-tooltip="Avan√ßar v√≠deo 2">‚è©</button>
          <button onclick="slowMotion(2)" data-tooltip="C√¢mera lenta para v√≠deo 2">‚è±Ô∏è</button>
          <button onclick="toggleFullScreen(2)" data-tooltip="Tela cheia para v√≠deo 2">üñ•Ô∏è Tela Cheia</button>
          <button onclick="removeVideo(2)" data-tooltip="Remover v√≠deo 2">‚úñÔ∏è Remover V√≠deo</button>
        </div>
      </div>
    </div>
    
    <!-- V√≠deo 3 -->
    <div class="video-wrapper">
      <input type="range" class="volume-slider" id="volume3" min="0" max="1" step="0.01" value="1">
      <div class="video-box" id="box3" ondrop="drop(event)" ondragover="allowDrop(event)">
        <video id="video3"></video>
      </div>
      <div class="progress-container">
        <input type="range" class="progress-slider" id="progress3" min="0" max="100" step="0.1" value="0">
        <div class="time-display" id="timeDisplay3">00:00 / 00:00</div>
      </div>
      <div class="file-info" id="info3">
        <p>Arquivo: Nenhum</p>
        <p>Tamanho: 0</p>
        <input type="text" id="rename3" placeholder="Renomear arquivo">
      </div>
      <div class="video-controls">
        <h3>V√≠deo 3</h3>
        <div class="controls-container single-row">
          <button onclick="playVideo(3)" data-tooltip="Reproduzir v√≠deo 3">‚ñ∂Ô∏è</button>
          <button onclick="pauseVideo(3)" data-tooltip="Pausar v√≠deo 3">‚è∏Ô∏è</button>
          <button onclick="stopVideo(3)" data-tooltip="Parar v√≠deo 3">‚¨ú</button>
          <button onclick="rewind(3)" data-tooltip="Recuar v√≠deo 3">‚è™</button>
          <button onclick="normalizeVideo(3)" data-tooltip="Normalizar velocidade de v√≠deo 3">üîÑ</button>
          <button id="muteButton3" onclick="toggleMuteVideo(3)" data-tooltip="Alternar mudo para v√≠deo 3">üîä</button>
          <button onclick="fastForward(3)" data-tooltip="Avan√ßar v√≠deo 3">‚è©</button>
          <button onclick="slowMotion(3)" data-tooltip="C√¢mera lenta para v√≠deo 3">‚è±Ô∏è</button>
          <button onclick="toggleFullScreen(3)" data-tooltip="Tela cheia para v√≠deo 3">üñ•Ô∏è Tela Cheia</button>
          <button onclick="removeVideo(3)" data-tooltip="Remover v√≠deo 3">‚úñÔ∏è Remover V√≠deo</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- CONTROLE GERAL DOS V√çDEOS -->
  <div class="section">
    <div class="general-controls">
      <button id="generalMark" onclick="markPositionAll()" data-tooltip="Marcar posi√ß√£o atual em todos os v√≠deos">üÖ∞Ô∏è Marcar</button>
      <button id="generalJump" onclick="jumpToMarkerAll()" data-tooltip="Voltar √† posi√ß√£o marcada em todos os v√≠deos">üÖ±Ô∏è Voltar</button>
      <button id="generalResetMarker" onclick="resetMarkerAll()" data-tooltip="Resetar marca√ß√µes">üÜé Reset </button>
      <button id="generalVolumeReset" onclick="resetVolumeAll()" data-tooltip="Resetar volume de todos os v√≠deos">üîä Reset</button>
      <button id="generalRewind" onclick="rewindAll()" data-tooltip="Recuar todos os v√≠deos">‚è™ Recuar</button>  
      <button onclick="pauseAll()" data-tooltip="Pausar todos os v√≠deos">‚è∏Ô∏è Pausar</button>  
      <button onclick="playAll()" data-tooltip="Reproduzir todos os v√≠deos">‚ñ∂Ô∏è Reprod.</button>  
      <button id="generalFastForward" onclick="fastForwardAll()" data-tooltip="Avan√ßar todos os v√≠deos">‚è© Avan√ßar</button>
      <button id="generalSlowMotion" onclick="slowMotionAll()" data-tooltip="C√¢mera lenta geral para todos os v√≠deos">‚è±Ô∏è Geral</button>
      <button id="generalNormalize" onclick="normalizeAll()" data-tooltip="Normalizar velocidade de todos os v√≠deos">üîÑ Geral</button>
      <button id="generalStop" onclick="stopAll()" data-tooltip="Parar todos os v√≠deos">‚¨ú Stop</button>
      <button onclick="removeAllVideos()" data-tooltip="Remover todos os v√≠deos">‚ùå Remover</button>
      <button id="generalRecord" onclick="toggleRecording()" data-tooltip="Iniciar ou parar grava√ß√£o">üî¥ Gravar</button>
      <button id="globalToggleTimeButton" class="toggle-time-button" onclick="toggleGlobalTimeDisplay()">
  üÜî Ocultar Tempos
</button>
      
      <p style="text-align: center; font-size:20px; font-style: italic; font-family: 'Courier New', Courier, monospace; margin-top: 19px;">
        ¬© 2025 Emanuel Aguiar <br>Todos os direitos reservados.
      </p>
    </div>
  </div>
  
  <!-- Canvas oculto para compor os v√≠deos e capturar a grava√ß√£o -->
  <canvas id="recordCanvas" width="960" height="180"></canvas>
  
  <script>
    /* --- Fun√ß√£o para formatar tamanho de arquivo --- */
    function formatFileSize(bytes) {
      if (bytes >= 1073741824) {
        return (bytes / 1073741824).toFixed(2) + " GB";
      } else if (bytes >= 1048576) {
        return (bytes / 1048576).toFixed(2) + " MB";
      } else if (bytes >= 1024) {
        return (bytes / 1024).toFixed(2) + " KB";
      } else {
        return bytes + " bytes";
      }
    }
    
    function toggleGlobalTimeDisplay() {
      // Seleciona todos os elementos de tempo
      const timeDisplays = document.querySelectorAll('.time-display');
      const toggleButton = document.getElementById("globalToggleTimeButton");

      // Checa o estado de exibi√ß√£o do primeiro elemento (assumindo que todos est√£o iguais)
      const isCurrentlyVisible = window.getComputedStyle(timeDisplays[0]).display !== "none";

      // Define o novo estado: se estiver vis√≠vel, vamos ocultar; caso contr√°rio, vamos mostrar
      const newDisplayValue = isCurrentlyVisible ? "none" : "block";

      // Atualiza o display de todos os elementos com a classe "time-display"
      timeDisplays.forEach(function(element) {
        element.style.display = newDisplayValue;
      });

      // Atualiza o texto do bot√£o de acordo com o novo estado
      toggleButton.textContent = isCurrentlyVisible ? "Mostrar Tempos" : "Ocultar Tempos";
    }
    
    /* --- Fun√ß√£o para atualizar a caixa de informa√ß√µes do arquivo --- */
    function updateFileInfo(videoId, file) {
      const infoDiv = document.getElementById("info" + videoId);
      infoDiv.innerHTML = `
        <p>Arquivo: ${file.name}</p>
        <p>Tamanho: ${formatFileSize(file.size)}</p>
        <p>Dura√ß√£o: <span id="duration${videoId}">00:00</span></p>
        <input type="text" id="rename${videoId}" placeholder="Renomear arquivo" value="${file.name}">
      `;
      localStorage.setItem("videoInfo" + videoId, JSON.stringify({ name: file.name, size: file.size }));
    }
    
    function loadFileInfo(videoId) {
      const infoData = localStorage.getItem("videoInfo" + videoId);
      if (infoData) {
        const info = JSON.parse(infoData);
        const infoDiv = document.getElementById("info" + videoId);
        infoDiv.innerHTML = `
          <p>Arquivo: ${info.name}</p>
          <p>Tamanho: ${formatFileSize(info.size)}</p>
          <p>Dura√ß√£o: <span id="duration${videoId}">00:00</span></p>
          <input type="text" id="rename${videoId}" placeholder="Renomear arquivo" value="${info.name}">
        `;
      }
    }
    
    /* --- Fun√ß√µes de Drag & Drop para carregar v√≠deo --- */
    function allowDrop(event) {
      event.preventDefault();
    }
    function drop(event) {
      event.preventDefault();
      const videoBox = event.target.closest('.video-box');
      if (videoBox) {
        const video = videoBox.querySelector('video');
        const files = event.dataTransfer.files;
        if (files.length > 0) {
          const file = files[0];
          video.src = URL.createObjectURL(file);
          video.load();
          const videoId = video.id.replace("video", "");
          updateFileInfo(videoId, file);
        }
      }
    }
    
    /* --- Fun√ß√µes de reprodu√ß√£o individual --- */
    function playVideo(id) {
      const video = document.getElementById('video' + id);
      if (video.src) video.play();
    }
    function pauseVideo(id) {
      const video = document.getElementById('video' + id);
      if (video.src) video.pause();
    }
    function stopVideo(id) {
      const video = document.getElementById('video' + id);
      if (video.src) {
        video.pause();
        video.currentTime = 0;
        video.playbackRate = 1;
      }
    }
    
    /* --- Fast‚ÄëForward: aumenta playbackRate em 0.5 --- */
    function fastForward(id) {
      const video = document.getElementById('video' + id);
      if (video && video.src) {
        if(video.playbackRate < 1) video.playbackRate = 1;
        video.playbackRate += 0.5;
        video.play();
      }
    }
    
    /* --- Rewind: subtrai 1.5 s a cada clique --- */
    function rewind(id) {
      const video = document.getElementById('video' + id);
      if (video && video.src) {
        video.currentTime = Math.max(0, video.currentTime - 1.5);
      }
    }
    
    /* --- C√¢mera lenta individual --- */
    function slowMotion(id) {
      const video = document.getElementById('video' + id);
      if (video && video.src) {
        video.playbackRate = 0.5;
        video.play();
      }
    }
    
    /* --- Normalizar individual (playbackRate) --- */
    function normalizeVideo(id) {
      const video = document.getElementById('video' + id);
      if (video && video.src) {
        video.playbackRate = 1;
      }
    }
    
    /* --- Fun√ß√£o para resetar o volume de todos os v√≠deos --- */
    function resetVolumeAll() {
      for (let i = 1; i <= 3; i++) {
        const video = document.getElementById('video' + i);
        const slider = document.getElementById('volume' + i);
        const muteButton = document.getElementById('muteButton' + i);
        if (video && slider) {
          video.volume = 1;
          slider.value = 1;
          if (video.muted) {
            video.muted = false;
            if (muteButton) {
              muteButton.textContent = "üîä";
            }
          }
        }
      }
    }
    
    /* --- Fun√ß√£o para alternar o mudo individual --- */
    function toggleMuteVideo(id) {
      const video = document.getElementById('video' + id);
      const muteButton = document.getElementById('muteButton' + id);
      const slider = document.getElementById('volume' + id);
      if (video) {
        video.muted = !video.muted;
        if (video.muted) {
          muteButton.textContent = "üîá";
          slider.value = 0;
        } else {
          muteButton.textContent = "üîä";
          video.volume = 1;
          slider.value = 1;
        }
      }
    }
    
    /* --- Controles Gerais: aplica para todos os v√≠deos --- */
    function fastForwardAll() {
      for (let i = 1; i <= 3; i++) {
        fastForward(i);
      }
    }
    function rewindAll() {
      for (let i = 1; i <= 3; i++) {
        rewind(i);
      }
    }
    function slowMotionAll() {
      document.querySelectorAll('video').forEach(video => {
        if (video.src) {
          video.playbackRate = 0.5;
          video.play();
        }
      });
    }
    function normalizeAll() {
      for (let i = 1; i <= 3; i++) {
        normalizeVideo(i);
      }
    }
    function stopAll() {
      for (let i = 1; i <= 3; i++) {
        stopVideo(i);
      }
    }
    
    /* --- Controles Gerais de Marca√ß√£o de Posi√ß√£o --- */
    let markerTimes = {};
    function markPositionAll() {
      for (let i = 1; i <= 3; i++) {
        const video = document.getElementById('video' + i);
        if (video && video.src) {
          markerTimes[i] = video.currentTime;
        }
      }
      console.log("Posi√ß√µes marcadas:", markerTimes);
    }
    function jumpToMarkerAll() {
      for (let i = 1; i <= 3; i++) {
        const video = document.getElementById('video' + i);
        if (video && video.src && markerTimes[i] !== undefined) {
          video.currentTime = markerTimes[i];
        }
      }
    }
    function resetMarkerAll() {
      markerTimes = {};
      console.log("Marca√ß√£o resetada");
    }
    
    /* --- Atualiza√ß√£o do slider de progresso e exibi√ß√£o do tempo --- */
    function updateProgress(id) {
      const video = document.getElementById('video' + id);
      const progress = document.getElementById('progress' + id);
      const timeDisplay = document.getElementById('timeDisplay' + id);
      if (video.duration) {
        const percent = (video.currentTime / video.duration) * 100;
        progress.value = percent;
        timeDisplay.textContent = formatTime(video.currentTime) + " / " + formatTime(video.duration);
        const durationSpan = document.getElementById('duration' + id);
        if (durationSpan && durationSpan.textContent === "00:00") {
          durationSpan.textContent = formatTime(video.duration);
        }
      }
    }
    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const sec = Math.floor(seconds % 60);
      return (hours < 10 ? "0" + hours : hours) + ":" +
        (minutes < 10 ? "0" + minutes : minutes) + ":" +
        (sec < 10 ? "0" + sec : sec);
    }
    function seekVideo(id) {
      const video = document.getElementById('video' + id);
      const progress = document.getElementById('progress' + id);
      if (video.duration) {
        video.currentTime = (progress.value / 100) * video.duration;
      }
    }
    
    /* --- Eventos para cada v√≠deo --- */
    document.addEventListener('DOMContentLoaded', function () {
      for (let i = 1; i <= 3; i++) {
        const video = document.getElementById('video' + i);
        video.addEventListener('timeupdate', function() {
          updateProgress(i);
        });
        const progress = document.getElementById('progress' + i);
        progress.addEventListener('input', function() {
          seekVideo(i);
        });
        loadFileInfo(i);
      }
      for (let i = 1; i <= 3; i++) {
        const slider = document.getElementById('volume' + i);
        slider.addEventListener('input', function () {
          const video = document.getElementById('video' + i);
          video.volume = slider.value;
        });
      }
      drawComposite();

      /* --- Adiciona os eventos de tooltip a todos os bot√µes que possuem data-tooltip --- */
      const buttons = document.querySelectorAll('button[data-tooltip]');
      buttons.forEach(function(btn) {
        btn.addEventListener('mouseenter', showTooltip);
        btn.addEventListener('mouseleave', hideTooltip);
      });
    });
    
    /* --- Controles Gerais de Reprodu√ß√£o --- */
    function playAll() {
      for (let i = 1; i <= 3; i++) {
        const video = document.getElementById('video' + i);
        if (video.src) video.play();
      }
    }
    function pauseAll() {
      for (let i = 1; i <= 3; i++) {
        const video = document.getElementById('video' + i);
        if (video.src) video.pause();
      }
    }
    function removeAllVideos() {
      for (let i = 1; i <= 3; i++) {
        removeVideo(i);
      }
    }
    
    /* --- Fun√ß√£o para remover individualmente um v√≠deo --- */
    function removeVideo(id) {
      const video = document.getElementById('video' + id);
      if (video) {
        video.src = "";
        video.load();
      }
      const infoDiv = document.getElementById("info" + id);
      infoDiv.innerHTML = `
        <p>Arquivo: Nenhum</p>
        <p>Tamanho: 0</p>
        <input type="text" id="rename${id}" placeholder="Renomear arquivo">
        <button onclick="removeVideo(${id})">Remover V√≠deo</button>
      `;
      localStorage.removeItem("videoInfo" + id);
    }
    
    /* --- Vari√°veis e fun√ß√µes para o temporizador dos popups --- */
    let recordingStartTime = null;
    let timerInterval = null;
    
    function startTimer() {
      recordingStartTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsedMs = Date.now() - recordingStartTime;
        const hours = Math.floor(elapsedMs / (1000 * 60 * 60));
        const minutes = Math.floor((elapsedMs / (1000 * 60)) % 60);
        const seconds = Math.floor((elapsedMs / 1000) % 60);
        const timeStr =
          (hours < 10 ? "0" + hours : hours) + ":" +
          (minutes < 10 ? "0" + minutes : minutes) + ":" +
          (seconds < 10 ? "0" + seconds : seconds);
        const popupRight = document.getElementById("popupRight");
        popupRight.textContent = timeStr;
        popupRight.style.display = "block";
      }, 1000);
    }
    
    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
      document.getElementById("popupRight").style.display = "none";
    }
    
    /* --- Grava√ß√£o da tela composta dos 3 v√≠deos --- */
    const video1 = document.getElementById('video1');
    const video2 = document.getElementById('video2');
    const video3 = document.getElementById('video3');
    const compositeCanvas = document.getElementById('recordCanvas');
    const compositeCtx = compositeCanvas.getContext('2d');
    
    let recording = false;
    let mediaRecorder;
    let recordedChunks = [];
    
    function drawComposite() {
      if(video1.readyState >= 2) {
        compositeCtx.drawImage(video1, 0, 0, 320, 180);
      }
      if(video2.readyState >= 2) {
        compositeCtx.drawImage(video2, 320, 0, 320, 180);
      }
      if(video3.readyState >= 2) {
        compositeCtx.drawImage(video3, 640, 0, 320, 180);
      }
      requestAnimationFrame(drawComposite);
    }
    
    function toggleRecording() {
      const recordButton = document.getElementById('generalRecord');
      if (!recording) {
        recordedChunks = [];
        const stream = compositeCanvas.captureStream(30);
        let mimeType = '';
        if (MediaRecorder.isTypeSupported('video/mp4')) {
          mimeType = 'video/mp4';
        } else {
          mimeType = 'video/webm; codecs=vp9';
        }
        try {
          mediaRecorder = new MediaRecorder(stream, { mimeType });
        } catch (e) {
          console.error('Erro ao iniciar MediaRecorder:', e);
          alert('Erro ao iniciar grava√ß√£o');
          return;
        }
        mediaRecorder.ondataavailable = function(event) {
          if (event.data.size > 0) {
            recordedChunks.push(event.data);
          }
        };
        mediaRecorder.onstop = function() {
          const blob = new Blob(recordedChunks, { type: mimeType });
          const url = URL.createObjectURL(blob);
          stopTimer();
          document.getElementById("popupLeft").style.display = "none";
          showSavePopup(url, mimeType);
        };
        mediaRecorder.start();
        recordButton.textContent = 'Parar Grava√ß√£o';
        recording = true;
        const popupLeft = document.getElementById("popupLeft");
        popupLeft.textContent = "Grava√ß√£o iniciada";
        popupLeft.style.display = "block";
        startTimer();
      } else {
        mediaRecorder.stop();
        recordButton.textContent = 'Gravar';
        recording = false;
      }
    }
    
    function showSavePopup(url, mimeType) {
      const popupSave = document.getElementById("popupSave");
      popupSave.innerHTML = `
        <p>Deseja salvar a grava√ß√£o?</p>
        <button id="saveYes" class="btn-green">Sim</button>
        <button id="saveNo" class="btn-red">N√£o</button>
      `;
      popupSave.style.display = "block";
      
      document.getElementById("saveYes").addEventListener("click", function(){
        const a = document.createElement('a');
        a.href = url;
        a.download = mimeType === 'video/mp4' ? 'gravacao.mp4' : 'gravacao.webm';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        popupSave.style.display = "none";
      });
      
      document.getElementById("saveNo").addEventListener("click", function(){
        popupSave.style.display = "none";
        URL.revokeObjectURL(url);
      });
    }
    
    function toggleFullScreen(videoId) {
      const video = document.getElementById('video' + videoId);
      if (!document.fullscreenElement) {
        video.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }
    
    /* --- Tooltip: exibe a dica ap√≥s 5 segundos de mouse parado --- */
    let tooltipTimeout;
    function showTooltip(event) {
      const button = event.currentTarget;
      tooltipTimeout = setTimeout(() => {
        let tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.innerHTML = button.getAttribute('data-tooltip');
        document.body.appendChild(tooltip);
        const rect = button.getBoundingClientRect();
        tooltip.style.top = (rect.top + window.scrollY - tooltip.offsetHeight - 5) + 'px';
        tooltip.style.left = (rect.left + window.scrollX + (button.offsetWidth - tooltip.offsetWidth) / 2) + 'px';
        button._tooltip = tooltip;
      }, 500);
    }
    function hideTooltip(event) {
      clearTimeout(tooltipTimeout);
      const button = event.currentTarget;
      if (button._tooltip) {
        document.body.removeChild(button._tooltip);
        button._tooltip = null;
      }
    }
  </script>
</body>
</html>
